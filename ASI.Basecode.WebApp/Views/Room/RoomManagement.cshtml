@model IEnumerable<ASI.Basecode.Services.ServiceModels.RoomViewModel>
@{
    ViewData["Title"] = "RoomManagement";
}

<div class="list-container">
    <link href="~/css/dashboards.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Heading and Controls -->
    <div class="header d-flex align-items-center">
        <h1 class="title">Room List</h1>
        <div class="controls">
            <div class="search-bar">
                <input type="text" placeholder="Search..." />
                <button class="search-button">
                    <i class="fa-solid fa-search"></i>
                </button>
                <button class="btn btn-add" id="loadCreateRoomModal">
                    + Add Room
                </button>
            </div>
        </div>
    </div>

    <!-- Placeholder for the modal content -->
    <div id="roomModalContainer"></div>

    <!-- Room List Table -->
    <div class="list-table">
        <div class="table-header">
            <span>Room Name</span>
            <span>Capacity</span>
            <span>Equipments</span>
            <span>Price</span>
            <span>Actions</span>
        </div>

        <div class="table-body">
            @if (Model != null && Model.Any())
            {
                foreach (var item in Model)
                {
                    <div class="table-row">
                        <span>@item.RoomName</span>
                        <span>@item.Capacity</span>
                        <span>@item.Equipment</span>
                        <span>@item.Price</span>

                        <div class="actions">
                            <!-- Edit Button -->
                            <button type="button" class="btn btn-warning loadEditRoomModal" data-id="@item.Id">
                                <i class="fas fa-pencil"></i> Edit
                            </button>

                            <!-- Delete Button -->
                            <button type="button" class="btn btn-danger loadDeleteRoomModal" data-id="@item.Id">
                                <i class="fa-solid fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="no-item">No rooms found.</div>
            }
        </div>
    </div>
</div>

@section scripts {

    <script>
        // Load the Modals
        $("#loadCreateRoomModal").click(function () {
            $.get('@Url.Action("CreateRoomModal", "Room")', function (data) {
                $("#roomModalContainer").html(data);  // Load modal content into the container
                var modalElement = document.getElementById('createRoomModal');
                var modal = new bootstrap.Modal(modalElement);
                modal.show();  // Show the modal
            });
        });

        $(document).on("click", ".loadEditRoomModal", function () {
            var id = $(this).data("id"); // Get the room ID from the button
            $.get('@Url.Action("EditRoomModal", "Room")', { id: id }, function (data) {
                $("#roomModalContainer").html(data); // Load modal content into the container
                var modalElement = document.getElementById('editRoomModal');
                var modal = new bootstrap.Modal(modalElement); // Initialize the modal using Bootstrap's JS
                modal.show();  // Show the modal
            });
        });

        $(document).on("click", ".loadDeleteRoomModal", function () {
            var id = $(this).data("id"); // Get the room ID from the button
            $.get('@Url.Action("DeleteRoomModal", "Room")', { id: id }, function (data) {
                $("#roomModalContainer").html(data); // Ensure correct modal container ID
                $('#deleteRoomModal').modal('show'); // Show the modal
            });
        });

        // AJAX form submission for Create Room
        $(document).on("submit", "#createRoomForm", function (event) {
            event.preventDefault();

            $.ajax({
                url: '@Url.Action("Create", "Room")',
                type: 'POST',
                data: $(this).serialize(),
                success: function (response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#createRoomModal').modal('hide');
                        location.reload();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function () {
                    toastr.error("An unexpected error occurred.");
                }
            });
        });

        // AJAX form submission for Edit Room
        $(document).on("submit", "#editRoomForm", function (event) {
            event.preventDefault();

            $.ajax({
                url: '@Url.Action("Edit", "Room")',
                type: 'POST',
                data: $(this).serialize(),
                success: function (response) {
                    if (response.success) {
                        toastr.success(response.message);
                        $('#editRoomModal').modal('hide');
                        location.reload();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function () {
                    toastr.error("An unexpected error occurred.");
                }
            });
        });

        // AJAX form submission for Delete Room
        $(document).on("submit", "#deleteRoomForm", function (event) {
            event.preventDefault(); // Prevent the default form submission

            $.ajax({
                url: '@Url.Action("SoftDelete", "Room")', // Soft delete action
                type: 'POST',
                data: $(this).serialize(),
                success: function (response) {
                    if (response.success) {
                        toastr.success(response.message); // Show success message
                        $('#deleteRoomModal').modal('hide'); // Hide the modal
                        location.reload(); // Refresh the page or update the list dynamically
                    } else {
                        toastr.error(response.message); // Show error message
                    }
                },
                error: function () {
                    toastr.error("An unexpected error occurred.");
                }
            });
        });


        // Display success/error messages from TempData if available
        var successMessage = '@TempData["SuccessMessage"]';
        if (successMessage) {
            toastr.success(successMessage);
        }
        var errorMessage = '@TempData["ErrorMessage"]';
        if (errorMessage) {
            toastr.error(errorMessage);
        }
    </script>
}
